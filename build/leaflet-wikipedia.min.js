!function(i,e){"function"==typeof define&&define.amd?define(["leaflet","browser-jsonp"],e):"object"==typeof exports?module.exports=e(require("leaflet"),require("browser-jsonp")):i.L=e(i.L,i.JSONP)}(this,function(i,e){"use strict";return i.Icon.WikipediaIcon=i.Icon.extend({options:{iconUrl:"images/wikipedia-icon.png",iconRetinaUrl:"images/wikipedia-icon-2x.png",iconSize:[40,40],popupAnchor:[0,-20]}}),i.icon.wikipediaIcon=function(){return new i.Icon.WikipediaIcon},i.LayerGroup.WikipediaLayer=i.LayerGroup.extend({PAGE:"?curid=",API:"w/api.php",options:{url:"https://en.wikipedia.org/",limit:100,popupOnMouseover:!1,clearOutsideBounds:!1,target:"_self",images:"images/",minZoom:0,maxZoom:18},initialize:function(e){e=e||{},i.Util.setOptions(this,e),-1===this.options.images.indexOf("/",this.options.images.length-1)&&(this.options.images+="/"),this._layers={}},onAdd:function(i){i.on("moveend",this.requestData,this),this._map=i,this.requestData()},onRemove:function(i){i.off("moveend",this.requestData,this),this.clearLayers(),this._layers={}},requestData:function(){var i=this._map.getZoom(),t=this._map.getCenter(),o={format:"json",action:"query",list:"geosearch",gslimit:this.options.limit,gsradius:this.getRadius(),gscoord:t.lat+"|"+t.lng},s=this;i>=this.options.minZoom&&i<=this.options.maxZoom?e({url:this.options.url+this.API,data:o,success:function(i){s.parseData(i)}}):(this.clearLayers(),this._layers={})},getMarker:function(e){var t=new i.Icon.WikipediaIcon({iconUrl:this.options.images+"wikipedia-icon.png",iconRetinaUrl:this.options.images+"wikipedia-icon-2x.png"}),o=i.marker([e.lat,e.lon],{icon:t}),s=this.options.url+this.PAGE+e.pageid,n='<a href="'+s+'" target="'+this.options.target+'">'+e.title+"</a>";return o.bindPopup(n),this.options.popupOnMouseover&&o.on("mouseover",function(i){i.target.openPopup()}),o},addMarker:function(i){var e=this.getMarker(i),t=i.pageid;this._layers[t]||(this._layers[t]=e,this.addLayer(e))},parseData:function(i){var e=i.query.geosearch,t=0,o=e.length;for(t;o>t;t+=1)this.addMarker(e[t]);this.options.clearOutsideBounds&&this.clearOutsideBounds()},getRadius:function(){var i=this._map.getBounds(),e=i.getNorthWest(),t=i.getSouthEast(),o=e.distanceTo(t)/2;return o>1e4?1e4:o},clearOutsideBounds:function(){var i,e,t=this._map.getBounds();for(e in this._layers)this._layers.hasOwnProperty(e)&&(i=this._layers[e].getLatLng(),t.contains(i)||(this.removeLayer(this._layers[e]),delete this._layers[e]))}}),i.layerGroup.wikipediaLayer=function(e){return new i.LayerGroup.WikipediaLayer(e)},i});